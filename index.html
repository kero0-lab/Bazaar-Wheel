<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ„ Ø¹Ø¬Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/winwheel@1.0.1/dist/Winwheel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">

<style>
body{
font-family:'Cairo',sans-serif;
background:radial-gradient(circle,#8b0000 0%,#2b0000 100%);
color:#fff;
margin:0;
min-height:100vh;
display:flex;
justify-content:center;
overflow-x:hidden;
}

/* â„ï¸ Ø§Ù„ØªÙ„Ø¬ */
.snowflake{
position:fixed;
top:-10px;
color:#fff;
animation:fall linear infinite;
z-index:1;
pointer-events:none;
}
@keyframes fall{
to{transform:translateY(110vh);}
}

.container{
position:relative;
z-index:10;
text-align:center;
padding:10px;
max-width:500px;
}

h1{
font-family:'Mountains of Christmas',cursive;
color:#FFD700;
font-size:2.8rem;
text-shadow:2px 2px 0 #000;
}

.wheel-wrapper{
position:relative;
margin:20px 0;
}

.pointer{
position:absolute;
top:-15px;
left:50%;
transform:translateX(-50%);
width:45px;
height:45px;
background:url('https://img.icons8.com/emoji/48/star-emoji.png') no-repeat center/contain;
z-index:10;
}

.form-box{
background:rgba(255,255,255,.95);
padding:20px;
border-radius:15px;
color:#000;
}

input{
width:80%;
padding:10px;
border-radius:8px;
border:2px solid #146B3A;
text-align:center;
font-size:16px;
}

button{
margin-top:10px;
width:90%;
padding:12px;
font-size:18px;
border-radius:8px;
border:none;
background:#146B3A;
color:#fff;
cursor:pointer;
font-weight:bold;
}

/* ğŸ popup */
#prizePopup{
display:none;
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%);
background:#FFD700;
color:#8B0000;
padding:30px;
border-radius:20px;
z-index:1000;
text-align:center;
}

#retryBtn{
margin-top:15px;
padding:10px 25px;
font-size:18px;
border:none;
border-radius:10px;
background:#8B0000;
color:#FFD700;
cursor:pointer;
font-weight:bold;
}
</style>
</head>

<body>

<div id="snow-container"></div>

<div class="container">
<h1>Christmas Spin ğŸ„</h1>

<div class="wheel-wrapper">
<div class="pointer"></div>
<canvas id="canvas" width="400" height="400"></canvas>
</div>

<div class="form-box">
<input type="email" id="email" placeholder="Ø§ÙƒØªØ¨ Ø§ÙŠÙ…ÙŠÙ„Ùƒ Ù‡Ù†Ø§">
<br>
<button onclick="spin()">Ù„Ù Ø§Ù„Ø¹Ø¬Ù„Ø© ğŸ…</button>
<p id="statusMsg" style="color:red;font-size:13px;"></p>
</div>
</div>

<div id="prizePopup">
<div id="prizeText"></div>
<button id="retryBtn" onclick="retrySpin()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø©</button>
</div>

<script>
const APP_SCRIPT_URL="https://script.google.com/macros/s/AKfycbz5eDQF4yhGhU-7iw-kdP5hCAjltudwP9FNt0v0VAcUuTFxbeeUk0wBfzpjpvdBfXgE7A/exec";
let theWheel;
let lastEmail="";

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø¬Ù„Ø© */
window.onload=()=>{
fetch(APP_SCRIPT_URL)
.then(r=>r.json())
.then(segments=>{
theWheel=new Winwheel({
numSegments:segments.length,
outerRadius:200,
innerRadius:30,
textFontSize:11,
textFontFamily:'Cairo',
segments:segments,
animation:{
type:'spinToStop',
duration:5,
spins:8,
callbackFinished:showPrize
}
});
});
createSnow();
};

/* Ù„Ù Ø§Ù„Ø¹Ø¬Ù„Ø© */
function spin(){
let email=document.getElementById('email').value.trim();
let status=document.getElementById('statusMsg');

if(email===""||!email.includes("@")){
status.innerText="Ø§ÙƒØªØ¨ Ø¥ÙŠÙ…ÙŠÙ„ ØµØ­ÙŠØ­";
return;
}
lastEmail=email;
status.innerText="";

let fd=new FormData();
fd.append("email",email);

fetch(APP_SCRIPT_URL,{method:"POST",body:fd})
.then(r=>r.json())
.then(data=>{
if(data.result==="success"){
let index=data.prizeIndex;

theWheel.stopAnimation(false);
theWheel.rotationAngle=0;
theWheel.draw();

theWheel.userData=theWheel.segments[index].text;
theWheel.animation.stopAngle=theWheel.getRandomForSegment(index+1);
theWheel.startAnimation();
}else{
status.innerText=data.message;
}
});
}

/* Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© */
function showPrize(){
document.getElementById("prizeText").innerText="ğŸ‰ Ø±Ø¨Ø­Øª: "+theWheel.userData;
document.getElementById("prizePopup").style.display="block";
}

/* ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© ÙÙˆØ±ÙŠØ© */
function retrySpin(){
document.getElementById("prizePopup").style.display="none";
document.getElementById("email").value=lastEmail;
spin(); // Ù„Ù ÙÙˆØ±Ù‹Ø§ Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø±
}

/* â„ï¸ Ø§Ù„ØªÙ„Ø¬ */
function createSnow(){
const c=document.getElementById("snow-container");
for(let i=0;i<40;i++){
let f=document.createElement("div");
f.className="snowflake";
f.innerText=["â„","â…","â†","â€¢"][Math.floor(Math.random()*4)];
f.style.left=Math.random()*100+"vw";
f.style.fontSize=(Math.random()*20+10)+"px";
f.style.opacity=Math.random();
f.style.animationDuration=(Math.random()*3+2)+"s";
c.appendChild(f);
}
}
</script>

</body>
</html>
